---
import { MessageCircle, Palette, Hammer, Wrench, ArrowRight } from 'lucide-astro'
import Button from '../ui/Button.astro'

interface Props {
  city?: string;
  cityData?: {
    sectionContent?: {
      process?: {
        heading?: string;
        subheading?: string;
        steps?: Array<{
          title: string;
          description: string;
        }>;
      };
    };
  };
}

const { city, cityData } = Astro.props;

// Get city-specific process content or use defaults
const processContent = cityData?.sectionContent?.process;
const heading = processContent?.heading || `Our Simple Process${city ? ` in ${city}` : ''}`;
const subheading = processContent?.subheading || (city
  ? `From initial consultation to ongoing maintenance, we make bringing your vision to life simple and stress-free. Our ${city}-based team ensures fast response times and personalized service every step of the way.`
  : `From initial consultation to ongoing maintenance, we make bringing your vision to life simple and stress-free.`
);

// Default steps with icon names
const defaultSteps = [
  {
    number: "01",
    title: "Initial Consultation",
    description: "We start with a free consultation to understand your vision, assess your space, and discuss your project goals.",
    iconName: "MessageCircle"
  },
  {
    number: "02", 
    title: "Custom Design",
    description: "Our expert team creates a detailed plan tailored to your space, budget, and preferences with professional renderings.",
    iconName: "Palette"
  },
  {
    number: "03",
    title: "Professional Installation",
    description: "Our skilled team handles the complete installation process with minimal disruption to your daily routine.",
    iconName: "Hammer"
  },
  {
    number: "04",
    title: "Ongoing Support",
    description: "We provide comprehensive maintenance services and support to keep your investment protected year-round.",
    iconName: "Wrench"
  }
];

// Icon mapping
const iconMap = {
  MessageCircle: MessageCircle,
  Palette: Palette,
  Hammer: Hammer,
  Wrench: Wrench
};

// Icon array for city-specific steps
const icons = [MessageCircle, Palette, Hammer, Wrench];

// Use city-specific steps if available, otherwise use defaults
const steps = processContent?.steps
  ? processContent.steps.map((step, index) => ({
      number: `0${index + 1}`,
      title: step.title,
      description: step.description,
      iconName: defaultSteps[index]?.iconName || "Hammer",
      IconComponent: icons[index] || Hammer
    }))
  : defaultSteps.map((step) => ({
      ...step,
      IconComponent: iconMap[step.iconName as keyof typeof iconMap] || Hammer
    }));
---

<section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
  <div class="container mx-auto max-w-7xl">
    <div class="text-center mb-16">
      <h2 class="text-4xl md:text-5xl font-bold text-foreground mb-6">
        {heading}
      </h2>
      <p class="text-xl text-muted-foreground max-w-3xl mx-auto leading-relaxed">
        {subheading}
      </p>
    </div>

    <div class="relative">
      {/* Desktop connection line */}
      <div class="hidden lg:block absolute top-1/2 left-0 right-0 h-0.5 transform -translate-y-1/2 process-connection-line" />
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 lg:gap-4">
        {steps.map((step, index) => {
          const IconComponent = step.IconComponent;
          return (
            <div class="relative flex flex-col">
              {/* Step card */}
              <div class="process-step-card bg-gray-50 rounded-xl p-6 shadow-sm hover:shadow-md transition-all duration-300 relative z-10 border border-gray-200/50 group flex flex-col flex-1">
                {/* Step number */}
                <div class="flex items-center justify-between mb-4">
                  <span class="text-4xl font-bold process-step-number">
                    {step.number}
                  </span>
                  <div class="w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 process-step-icon-bg">
                    <IconComponent class="w-8 h-8 process-step-icon" />
                  </div>
                </div>
                
                {/* Step content */}
                <h3 class="text-xl md:text-2xl font-semibold text-foreground mb-3">
                  {step.title}
                </h3>
                <p class="text-gray-600 text-base leading-relaxed">
                  {step.description}
                </p>
              </div>

              {/* Arrow connector for mobile */}
              {index < steps.length - 1 && (
                <div class="lg:hidden flex justify-center mt-6 mb-6">
                  <ArrowRight class="w-6 h-6 process-arrow" />
                </div>
              )}
            </div>
          );
        })}
      </div>
    </div>

    {/* Bottom CTA */}
    <div class="text-center mt-16">
      <p class="text-muted-foreground mb-6">
        {city 
          ? `Ready to start your project in ${city}? Our local team is standing by to help.`
          : `Ready to start your project journey?`
        }
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <Button size="lg" href="/contact">
          Start Your Project
        </Button>
        <Button variant="outline" size="lg" href="/portfolio">
          View Our Work
        </Button>
      </div>
    </div>
  </div>
</section>

<style>
  .process-step-number {
    color: hsl(var(--primary));
  }
  
  .process-step-icon {
    color: hsl(var(--primary));
  }
  
  .process-step-icon-bg {
    background: linear-gradient(to bottom right, hsl(var(--primary) / 0.2), hsl(var(--primary) / 0.1));
  }
  
  .process-step-card:hover {
    border-color: hsl(var(--primary) / 0.2);
  }
  
  .process-step-card:hover .process-step-icon-bg {
    background: linear-gradient(to bottom right, hsl(var(--primary) / 0.3), hsl(var(--primary) / 0.2));
  }
  
  .process-connection-line {
    background: linear-gradient(to right, hsl(var(--primary) / 0.2), hsl(var(--primary)), hsl(var(--primary) / 0.2));
  }
  
  .process-arrow {
    color: hsl(var(--primary) / 0.4);
  }
  
  /* Ensure all cards have equal height */
  .grid > div {
    display: flex;
    flex-direction: column;
  }
  
  .process-step-card {
    height: 100%;
    display: flex;
    flex-direction: column;
  }
</style>
